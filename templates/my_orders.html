{% extends "layout.html" %}

{% block title %}–ú–æ–∏ –∑–∞–∫–∞–∑—ã - Cursor ShopüõçÔ∏è{% endblock %}

{% block extra_css %}
<style>
    .order-card {
        transition: transform 0.2s, box-shadow 0.2s;
        margin-bottom: 20px;
    }
    .order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .order-status {
        font-size: 0.9rem;
        padding: 5px 10px;
        border-radius: 20px;
        display: inline-block;
    }
    .empty-orders {
        text-align: center;
        padding: 50px 20px;
        background-color: #f8f9fa;
        border-radius: 10px;
        margin: 30px 0;
    }
    .empty-orders i {
        font-size: 4rem;
        color: #dee2e6;
        margin-bottom: 20px;
    }
    .error-message {
        text-align: center;
        padding: 30px 20px;
        background-color: #fff3cd;
        border-radius: 10px;
        margin: 30px 0;
        border: 1px solid #ffeeba;
    }
    .error-message i {
        font-size: 3rem;
        color: #ffc107;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
    
    {% if error_message %}
    <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <h4>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</h4>
        <p>{{ error_message }}</p>
        <a href="{{ url_for('products') }}" class="btn btn-primary mt-3">
            <i class="fas fa-shopping-bag me-2"></i>–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º
        </a>
    </div>
    {% elif orders and orders|length > 0 %}
    <div class="row">
        {% for order in orders %}
        <div class="col-md-6">
            <div class="card order-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">–ó–∞–∫–∞–∑ #{{ order.id }}</h5>
                    <span class="order-status {% if order.status == 'pending' %}bg-warning
                                         {% elif order.status == 'paid' %}bg-success
                                         {% elif order.status == 'shipped' %}bg-info
                                         {% elif order.status == 'delivered' %}bg-primary
                                         {% elif order.status == 'cancelled' %}bg-danger
                                         {% endif %} text-white">
                        {% if order.status == 'pending' %}–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
                        {% elif order.status == 'paid' %}–û–ø–ª–∞—á–µ–Ω
                        {% elif order.status == 'shipped' %}–û—Ç–ø—Ä–∞–≤–ª–µ–Ω
                        {% elif order.status == 'delivered' %}–î–æ—Å—Ç–∞–≤–ª–µ–Ω
                        {% elif order.status == 'cancelled' %}–û—Ç–º–µ–Ω–µ–Ω
                        {% endif %}
                    </span>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <p class="mb-1"><strong>–î–∞—Ç–∞:</strong></p>
                            <p>{{ order.created_at.strftime('%d.%m.%Y') }}</p>
                        </div>
                        <div class="col-6">
                            <p class="mb-1"><strong>–°—É–º–º–∞:</strong></p>
                            <p>{{ order.total_amount }} ‚Ç¥</p>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <p class="mb-1"><strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong></p>
                        <p>{{ order.shipping_address }}, {{ order.shipping_city }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <p class="mb-1"><strong>–¢–æ–≤–∞—Ä—ã:</strong></p>
                        <ul class="list-unstyled">
                            {% for item in order.items[:3] %}
                            <li>{{ item.product.name }} x {{ item.quantity }}</li>
                            {% endfor %}
                            {% if order.items|length > 3 %}
                            <li class="text-muted">... –∏ –µ—â–µ {{ order.items|length - 3 }} —Ç–æ–≤–∞—Ä(–æ–≤)</li>
                            {% endif %}
                        </ul>
                    </div>
                    
                    <div class="d-grid">
                        <a href="{{ url_for('order_details', order_id=order.id) }}" class="btn btn-primary">
                            <i class="fas fa-eye me-2"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏
                        </a>
                    </div>
                </div>
                <div class="card-footer text-muted">
                    {% if order.status == 'pending' %}
                    <button class="btn btn-sm btn-outline-danger float-end" onclick="confirmCancel({{ order.id }})">
                        <i class="fas fa-times me-1"></i>–û—Ç–º–µ–Ω–∏—Ç—å
                    </button>
                    {% endif %}
                    <small>–û–±–Ω–æ–≤–ª–µ–Ω–æ: {{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-orders">
        <i class="fas fa-shopping-bag"></i>
        <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</h3>
        <p class="text-muted">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ –∑–∞–∫–∞–∑—ã –ø–æ—Å–ª–µ —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫</p>
        <a href="{{ url_for('products') }}" class="btn btn-primary mt-3">
            <i class="fas fa-shopping-cart me-2"></i>–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º
        </a>
    </div>
    {% endif %}
</div>

<script>
function confirmCancel(orderId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ #' + orderId + '?')) {
        // Here you would redirect to a cancel order route
        // window.location.href = '/cancel-order/' + orderId;
        alert('–§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è');
    }
}
</script>
{% endblock %} 